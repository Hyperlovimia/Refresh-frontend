# Change: 添加通风分析设计核心功能

## Why

基于 PRD（tmp/Docs/prd_demo_version.md）的需求，实现通风分析系统的微信小程序核心功能。该功能允许用户通过网格化画布进行房间结构设计，为后续的通风分析提供基础数据。

本次提案采用增量式策略，仅实现核心画布绘制功能（P0 优先级），家具层和叠加层将在后续提案中实现。

## What Changes

### 新增功能

- **Canvas 网格系统**：初始化网格画布，支持坐标计算和网格显示切换
- **基础层绘制**：墙壁、房间、门、窗的绘制与选择删除
- **设计持久化**：本地缓存保存/加载 + 后端 API 对接

### 新增文件

- `pages/design/` - 设计页面（含 Canvas 画布和工具栏）
- `pages/design/utils/` - 网格计算和绘制工具函数

### 配置变更

- `app.json` - 新增 design 页面路由

## Impact

- **新增 specs**：
  - `canvas-grid-system`：画布网格基础设施
  - `base-layer-drawing`：基础层元素绘制
  - `design-persistence`：设计数据持久化
- **受影响代码**：
  - `app.json`（新增页面路由）
  - 新增 `pages/design/` 目录

## 设计决策

1. 使用 Canvas 2D API（微信官方推荐，性能更优）
2. 采用格子坐标系统（非像素坐标），便于后端处理
3. 元素绘制采用网格吸附，确保对齐
4. 复用 PRD 中定义的后端 API 设计
5. 本次不实现画布缩放/平移功能

## 开放问题

> 以下问题需要在实现前确认：

1. ~~是否需要画布缩放/平移？~~ → **暂不实现**
2. 元素重叠如何处理？→ **后绘制覆盖前绘制**
3. 网格尺寸是否可配置？→ **固定 20x20 格子**

## 后续规划

- `add-ventilation-furniture-layer`：家具层放置功能
- `add-ventilation-overlay`：叠加层可视化与热力图
