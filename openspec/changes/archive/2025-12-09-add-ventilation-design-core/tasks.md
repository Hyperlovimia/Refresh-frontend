# Tasks: 通风分析设计核心功能

## 1. 基础设施

- [x] 1.1 在 `app.json` 中添加 design 页面路由
- [x] 1.2 创建 `pages/design/` 目录及基础文件（wxml/js/json/less）
- [x] 1.3 实现页面基础布局（顶栏、工具栏、画布区域）

## 2. Canvas 网格系统

- [x] 2.1 创建 `pages/design/utils/grid.js` 网格计算工具
  - 格子坐标 ↔ 像素坐标转换
  - 网格尺寸计算
- [x] 2.2 实现 Canvas 初始化逻辑
  - 获取 Canvas 上下文
  - 设置画布尺寸
- [x] 2.3 实现网格线渲染
  - 绘制 20x20 网格
  - 支持网格显示/隐藏切换
- [x] 2.4 实现坐标显示功能
  - 跟随触摸位置显示当前格子坐标

## 3. 基础层绘制

- [x] 3.1 创建 `pages/design/utils/drawing.js` 绘制工具
  - 墙壁绘制函数
  - 房间绘制函数
  - 门窗绘制函数
- [x] 3.2 实现工具栏切换逻辑
  - 当前工具状态管理
  - 工具按钮 UI
- [x] 3.3 实现墙壁绘制
  - touchstart 记录起点
  - touchmove 预览线段
  - touchend 确认墙壁
- [x] 3.4 实现房间绘制
  - 拖拽绘制矩形区域
  - 填充房间颜色
- [x] 3.5 实现门窗绘制
  - 点击放置门/窗
  - 自动判断方向（水平/垂直）
- [x] 3.6 实现元素选择
  - 点击检测命中元素
  - 高亮选中元素
- [x] 3.7 实现元素删除
  - 选中后点击删除按钮
  - 从数据中移除元素

## 4. 设计持久化

- [x] 4.1 实现本地缓存保存
  - `wx.setStorageSync('current_design', data)`
- [x] 4.2 实现本地缓存加载
  - 页面 onLoad 时恢复数据
- [x] 4.3 实现后端 API 保存
  - POST `/api/designs`
  - 处理成功/失败提示
- [x] 4.4 实现文件列表获取
  - GET `/api/files`
  - 显示文件选择弹窗
- [x] 4.5 实现后端 API 加载
  - POST `/api/designs/load`
  - 加载并渲染设计

## 5. 验证

- [x] 5.1 验证网格渲染正确性
- [x] 5.2 验证各元素绘制功能
- [x] 5.3 验证保存/加载流程
- [x] 5.4 验证与后端 API 对接

## 依赖关系

```
1.1 → 1.2 → 1.3
         ↓
2.1 → 2.2 → 2.3 → 2.4
              ↓
3.1 → 3.2 → 3.3/3.4/3.5（可并行）→ 3.6 → 3.7
                                      ↓
4.1/4.2（可并行）→ 4.3 → 4.4 → 4.5
                              ↓
                           5.1 → 5.2 → 5.3 → 5.4
```
